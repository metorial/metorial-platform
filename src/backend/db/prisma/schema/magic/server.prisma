enum MagicMcpServerStatus {
  active
  archived
  deleted
}

model MagicMcpServer {
  oid    BigInt               @id @default(autoincrement())
  id     String               @unique
  status MagicMcpServerStatus

  instanceOid BigInt
  instance    Instance @relation(fields: [instanceOid], references: [oid])

  name        String?
  description String?

  metadata Json

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  aliases  MagicMcpServerAlias[]
  sessions MagicMcpSession[]

  serverDeployment MagicMcpServerDeployment?
}

model MagicMcpServerDeployment {
  oid BigInt @id @default(autoincrement())
  id  String @unique

  magicMcpServerOid BigInt         @unique // Unique for now since we don't support multiple deployments per server
  magicMcpServer    MagicMcpServer @relation(fields: [magicMcpServerOid], references: [oid])

  serverDeploymentOid BigInt
  serverDeployment    ServerDeployment @relation(fields: [serverDeploymentOid], references: [oid])

  createdAt DateTime @default(now())

  @@unique([magicMcpServerOid, serverDeploymentOid])
}

model MagicMcpServerAlias {
  oid  BigInt @id @default(autoincrement())
  slug String @unique

  serverOid BigInt
  server    MagicMcpServer @relation(fields: [serverOid], references: [oid])
}

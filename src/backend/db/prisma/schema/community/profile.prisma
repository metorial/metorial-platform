enum ProfileType {
  system
  user
  organization
  external
}

model Profile {
  oid BigInt @id @default(autoincrement())
  id  String @unique

  updateAllowed Boolean @default(true)
  isCustomized  Boolean @default(false)

  type ProfileType

  name        String
  description String?
  slug        String  @unique

  /// [EntityImage]
  image Json

  /// [ProfileAttributes]
  attributes Json

  organizationOid BigInt?       @unique
  organization    Organization? @relation(fields: [organizationOid], references: [oid], onDelete: Cascade)

  userOid BigInt? @unique
  user    User?   @relation(fields: [userOid], references: [oid], onDelete: Cascade)

  providerOid BigInt?                @unique
  provider    ServerVariantProvider? @relation(fields: [providerOid], references: [oid], onDelete: SetNull)

  vendors                ImportedServerVendor[]
  serverListings         ServerListing[]
  providerOAuthTemplates ProviderOAuthConnectionTemplate[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  profileUpdates ProfileUpdate[]
}

model ProfileUpdate {
  oid BigInt @id @default(autoincrement())
  id  String @unique

  before Json
  after  Json

  createdByOid BigInt
  createdBy    OrganizationActor @relation(fields: [createdByOid], references: [oid], onDelete: Cascade)

  profileOid BigInt
  profile    Profile @relation(fields: [profileOid], references: [oid], onDelete: Cascade)

  createdAt DateTime @default(now())
}

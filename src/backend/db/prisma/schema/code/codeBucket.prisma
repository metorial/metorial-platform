enum CodeBucketPurpose {
  custom_server
}

enum CodeBucketStatus {
  ready
  importing
}

model CodeBucket {
  oid BigInt @id @default(autoincrement())
  id  String @unique

  purpose CodeBucketPurpose
  status  CodeBucketStatus  @default(ready)

  isReadOnly Boolean @default(false)

  instanceOid BigInt
  instance    Instance @relation(fields: [instanceOid], references: [oid])

  parentOid BigInt?
  parent    CodeBucket?  @relation("CodeBucketParent", fields: [parentOid], references: [oid], onDelete: SetNull)
  children  CodeBucket[] @relation("CodeBucketParent")

  templateOid BigInt?
  template    CodeBucketTemplate? @relation(fields: [templateOid], references: [oid])

  repositoryOid BigInt?
  repository    ScmRepo? @relation(fields: [repositoryOid], references: [oid])
  path          String?

  createdAt DateTime @default(now())

  customServers         CustomServer[]
  lambdaServerInstances LambdaServerInstance[]
  providerFor           CodeBucketTemplate[]   @relation("ProviderBucket")
}

model CodeBucketTemplate {
  oid BigInt @id @default(autoincrement())
  id  String @unique

  name String

  /// [CodeBucketTemplateContents]
  contents Json

  providerBucketOid BigInt?
  providerBucket    CodeBucket? @relation(fields: [providerBucketOid], references: [oid], name: "ProviderBucket")

  createdAt DateTime @default(now())

  buckets                CodeBucket[]
  managedServerTemplates ManagedServerTemplate[]
}

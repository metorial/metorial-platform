enum ServerVariantSourceType {
  docker
  remote
  managed
}

model ServerVariant {
  oid    BigInt       @id @default(autoincrement())
  id     String       @unique
  status ServerStatus @default(active)

  identifier String @unique

  isDefault Boolean @default(true) // Not unique

  defaultForInstanceOid BigInt?
  defaultForInstance    Instance? @relation(fields: [defaultForInstanceOid], references: [oid], name: "ServerVariantDefaultForInstance")

  onlyForInstanceOid BigInt?
  onlyForInstance    Instance? @relation(fields: [onlyForInstanceOid], references: [oid], name: "ServerVariantOnlyForInstance")

  providerOid BigInt
  provider    ServerVariantProvider @relation(fields: [providerOid], references: [oid])

  serverOid BigInt
  server    Server @relation(fields: [serverOid], references: [oid])

  currentVersionOid BigInt?
  currentVersion    ServerVersion? @relation(fields: [currentVersionOid], references: [oid], name: "ServerVariantCurrentServerConfig")

  sourceType ServerVariantSourceType

  dockerImage String?
  remoteUrl   String?

  mcpVersion   String       @default("2024-11-05")
  mcpTransport McpTransport @default(sse) // For remote servers

  /// [ServerVersionTools]
  tools Json @default("null")

  /// [ServerVersionPrompts]
  prompts Json @default("null")

  /// [ServerVersionResourceTemplates]
  resourceTemplates Json @default("null")

  /// [ServerVersionServerInfo]
  serverInfo Json @default("null")

  /// [ServerVersionServerCapabilities]
  serverCapabilities Json @default("null")

  /// [ServerVersionServerInstructions]
  serverInstructions Json @default("null")

  versions                ServerVersion[]
  serverImplementations   ServerImplementation[]
  serverDeployments       ServerDeployment[]
  serverAutoDiscoveryJobs ServerAutoDiscoveryJob[]

  createdAt        DateTime  @default(now())
  lastDiscoveredAt DateTime?

  customServer CustomServer?
}

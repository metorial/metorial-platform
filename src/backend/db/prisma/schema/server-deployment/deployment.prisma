enum ServerDeploymentStatus {
  active
  archived
  deleted
  failed
}

model ServerDeployment {
  oid    BigInt                 @id @default(autoincrement())
  id     String                 @unique
  status ServerDeploymentStatus

  isEphemeral       Boolean
  isMagicMcpSession Boolean @default(false)

  name        String?
  description String?

  metadata Json?

  serverImplementationOid BigInt
  serverImplementation    ServerImplementation @relation(fields: [serverImplementationOid], references: [oid])

  serverVariantOid BigInt
  serverVariant    ServerVariant @relation(fields: [serverVariantOid], references: [oid])

  serverOid BigInt
  server    Server @relation(fields: [serverOid], references: [oid])

  configOid BigInt
  config    ServerDeploymentConfig @relation(fields: [configOid], references: [oid])

  instanceOid BigInt
  instance    Instance @relation(fields: [instanceOid], references: [oid])

  oauthConnectionOid BigInt?
  oauthConnection    ProviderOAuthConnection? @relation(fields: [oauthConnectionOid], references: [oid], name: "ProviderOAuthConnectionServerDeployments")

  oauthConfigOid BigInt?
  oauthConfig    ProviderOAuthConfig? @relation(fields: [oauthConfigOid], references: [oid])

  callbackOid BigInt?   @unique
  callback    Callback? @relation(fields: [callbackOid], references: [oid])

  failureCode    String?
  failureMessage String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  serverRunErrors           ServerRunError[]
  serverSessions            ServerSession[]
  serverRuns                ServerRun[]
  sessionsOldDontUse        Session[]
  serverAutoDiscoveryJobs   ServerAutoDiscoveryJob[]
  sessionServerDeployments  SessionServerDeployment[]
  magicMcpServerDeployments MagicMcpServerDeployment[]
}
